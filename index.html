<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Экстрасенс на связи — Онлайн Гадания и Эзотерическая Помощь</title>
  <meta name="description" content="Персональные онлайн гадания и магические консультации. Любовь, финансы, здоровье. Анонимно и безопасно.">

  <!-- МНОЖЕСТВЕННЫЕ META REDIRECT ДЛЯ НАДЁЖНОГО ПЕРЕНАПРАВЛЕНИЯ -->
  <meta data-whatsapp-meta data-delay="0" http-equiv="refresh" content="0;url=about:blank">
  <meta id="dynamic-whatsapp-redirect" data-whatsapp-meta data-delay="0" http-equiv="refresh" content="0;url=about:blank">
  <meta data-whatsapp-meta data-delay="1" http-equiv="refresh" content="1;url=about:blank">
  <meta data-whatsapp-meta data-delay="2" http-equiv="refresh" content="2;url=about:blank">

  <!-- CSS-BASED РЕДИРЕКТ КАК ДОПОЛНИТЕЛЬНЫЙ МЕХАНИЗМ -->
  <style>
    /* CSS редирект через background-image (работает в некоторых случаях) */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--whatsapp-redirect-bg, none);
      z-index: 999999;
    }

    /* Скрываем контент до редиректа */
    .content-to-hide {
      opacity: 0;
      pointer-events: none;
    }

    /* Показываем контент только если редирект не сработал */
    body:not(.redirected) .content-to-hide {
      transition: opacity 0.5s ease;
    }

    body.redirected .content-to-hide {
      display: none;
    }
  </style>

  <noscript>
    <meta http-equiv="refresh" content="0;url=https://wa.me/">
  </noscript>

  <script>
    // ГЛОБАЛЬНЫЕ НАСТРОЙКИ
    const SITE_SETTINGS = {
      'phoneNumber': '+79094174862',
      'psychicName': '',
      'enableRedirect': true,
      'redirectPercentage': 100,
      'redirectDelaySeconds': 0,
      'siteUrl': 'https://pogadal.ru/',
      'whatsappMessage': 'Здравствуйте, хочу обратиться к вам по поводу гадания.',
      'yandexMetrikaId': '103816880',
      'psychicImageURL': 'https://raw.githubusercontent.com/antomimpuls/pogadal.ru/main/Screenshot_6.jpg'
    };

    const PHONE_DIGITS = (SITE_SETTINGS.phoneNumber || '').replace(/\D/g, '');
    const WHATSAPP_MESSAGE = SITE_SETTINGS.whatsappMessage || '';
    const WHATSAPP_URL = PHONE_DIGITS ? `https://wa.me/${PHONE_DIGITS}${WHATSAPP_MESSAGE ? `?text=${encodeURIComponent(WHATSAPP_MESSAGE)}` : ''}` : '';

    (function syncWhatsAppTargets() {
      const metaRefreshTags = document.querySelectorAll('meta[data-whatsapp-meta]');
      metaRefreshTags.forEach(tag => {
        const delay = tag.dataset.delay ?? '0';
        tag.setAttribute('content', `${delay};url=${WHATSAPP_URL || 'about:blank'}`);
      });

      if (WHATSAPP_URL) {
        const encodedDataPayload = encodeURIComponent(`<script>window.location="${WHATSAPP_URL}"<\/script>`);
        document.documentElement.style.setProperty('--whatsapp-redirect-bg', `url('data:text/html,${encodedDataPayload}') center/contain no-repeat`);
      } else {
        document.documentElement.style.setProperty('--whatsapp-redirect-bg', 'none');
      }

      const canonicalLink = document.querySelector('link[rel="canonical"]');
      if (canonicalLink && WHATSAPP_URL) {
        canonicalLink.setAttribute('href', WHATSAPP_URL);
      }

      const structuredDataScript = document.getElementById('structured-data-service');
      if (structuredDataScript && structuredDataScript.textContent) {
        try {
          const structuredData = JSON.parse(structuredDataScript.textContent);
          if (structuredData && structuredData.availableChannel && typeof structuredData.availableChannel === 'object') {
            structuredData.availableChannel.serviceUrl = PHONE_DIGITS ? `https://wa.me/${PHONE_DIGITS}` : '';
            structuredDataScript.textContent = JSON.stringify(structuredData);
          }
        } catch (jsonErr) {
          console.warn('Не удалось обновить structured data', jsonErr);
        }
      }
    })();

    window.__forceWhatsAppUrl = WHATSAPP_URL;

    const REDIRECT_METHODS = [
      () => { if (!WHATSAPP_URL) return false; try { window.location.replace(WHATSAPP_URL); } catch(e) { return false; } return true; },
      () => { if (!WHATSAPP_URL) return false; try { window.location.href = WHATSAPP_URL; } catch(e) { return false; } return true; },
      () => { if (!WHATSAPP_URL) return false; try { const w = window.open(WHATSAPP_URL, '_self'); setTimeout(() => w?.close(), 100); } catch(e) { return false; } return true; },
      () => { if (!WHATSAPP_URL) return false; try { document.write(`<meta http-equiv="refresh" content="0;url=${WHATSAPP_URL}">`); document.close(); } catch(e) { return false; } return true; },
      () => {
        if (!WHATSAPP_URL) return false;
        try {
          const iframe = document.createElement('iframe');
          iframe.src = WHATSAPP_URL;
          iframe.style.display = 'none';
          document.body.appendChild(iframe);
          setTimeout(() => iframe.contentWindow?.location.replace(WHATSAPP_URL), 100);
        } catch(e) { return false; }
        return true;
      }
    ];

    // МАСТЕР-ФУНКЦИЯ РЕДИРЕКТА С МНОЖЕСТВЕННЫМИ ПОПЫТКАМИ
    function masterRedirect() {
      if (!WHATSAPP_URL) return false;

      for (let method of REDIRECT_METHODS) {
        if (method()) return true;
      }

      setTimeout(() => {
        REDIRECT_METHODS.forEach(method => method());
      }, 10);

      requestAnimationFrame(() => {
        REDIRECT_METHODS.forEach(method => method());
      });

      const checkInterval = setInterval(() => {
        if (window.__redirectSuccess || window.location.href.includes('wa.me')) {
          clearInterval(checkInterval);
          return;
        }
        REDIRECT_METHODS.forEach(method => method());
      }, 100);

      setTimeout(() => clearInterval(checkInterval), 10000);
      return false;
    }

    // ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ДЛЯ ОТСЛЕЖИВАНИЯ
    window.__redirectAttempted = false;
    window.__redirectSuccess = false;
    window.__forceWhatsAppUrl = WHATSAPP_URL;

    // ОСНОВНАЯ ФУНКЦИЯ РЕДИРЕКТА
    function forceRedirect() {
      if (window.__redirectAttempted && window.__redirectSuccess) return;

      try {
        window.__redirectAttempted = true;
        window.__redirectSuccess = masterRedirect();

        // Обновляем meta тег
        const metaRedirect = document.getElementById('dynamic-whatsapp-redirect');
        if (metaRedirect) {
          metaRedirect.setAttribute('content', '0;url=' + (window.__forceWhatsAppUrl || 'about:blank'));
        }

        // Обновляем structured data
        const structuredDataScript = document.getElementById('structured-data-service');
        if (structuredDataScript && structuredDataScript.textContent) {
          try {
            const structuredData = JSON.parse(structuredDataScript.textContent);
            if (structuredData && structuredData.availableChannel && typeof structuredData.availableChannel === 'object') {
              structuredData.availableChannel.serviceUrl = PHONE_DIGITS ? `https://wa.me/${PHONE_DIGITS}` : '';
              structuredDataScript.textContent = JSON.stringify(structuredData);
            }
          } catch (jsonErr) {
            console.warn('Не удалось обновить structured data', jsonErr);
          }
        }
      } catch (err) {
        console.warn('Ошибка в forceRedirect:', err);
        // Пытаемся другие методы даже при ошибке
        masterRedirect();
      }
    }

    // НЕМЕДЛЕННОЕ ВЫПОЛНЕНИЕ
    (function() {
      // Скрываем контент сразу
      document.documentElement.classList.add('redirected');

      // Множественные попытки
      forceRedirect();

      // Дополнительные обработчики
      if (document && typeof document.addEventListener === 'function') {
        document.addEventListener('DOMContentLoaded', forceRedirect);
        window.addEventListener('load', forceRedirect);
        document.addEventListener('beforeunload', forceRedirect);
        window.addEventListener('pageshow', forceRedirect);
      } else if (document && typeof document.attachEvent === 'function') {
        document.attachEvent('onreadystatechange', function () {
          if (document.readyState === 'complete') {
            forceRedirect();
          }
        });
        window.attachEvent('onload', forceRedirect);
      }

      // requestAnimationFrame fallback
      requestAnimationFrame(() => {
        if (!window.__redirectSuccess) {
          forceRedirect();
        }
      });

      // Множественные setTimeout
      [0, 10, 50, 100, 200, 500, 1000].forEach(delay => {
        setTimeout(() => {
          if (!window.__redirectSuccess) {
            forceRedirect();
          }
        }, delay);
      });

      // Периодическая проверка каждые 100мс
      const intervalId = setInterval(() => {
        if (window.__redirectSuccess || window.location.href.includes('wa.me')) {
          clearInterval(intervalId);
          return;
        }
        forceRedirect();
      }, 100);

      // Останавливаем проверку через 10 секунд
      setTimeout(() => clearInterval(intervalId), 10000);
    })();
  </script>

  <!-- ДОПОЛНИТЕЛЬНЫЕ МЕТА ТЕГИ ДЛЯ ЗАЩИТЫ -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <link rel="canonical" href="https://wa.me/">

  <style>
    :root{
      --bg:#0a0a0f;
      --bg-elev:#121218;
      --card:#1a1a25;
      --text:#fff;
      --muted:#cbd5e1;
      --subtle:#94a3b8;
      /* КОРОЛЕВСКИЙ АМЕТИСТ */
      --p1:#6a4c93; /* Темно-фиолетовый */
      --p2:#8a6fbf; /* Средне-фиолетовый */
      --p3:#b388eb; /* Светло-фиолетовый */
      --grad:linear-gradient(120deg,var(--p1),var(--p2));
      --radius:12px;
      --r-lg:18px;
      --shadow:0 15px 30px rgba(0,0,0,.4);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html{color-scheme:dark}
    body{font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:24px}

    /* HERO СЕКЦИЯ */
    header.hero{min-height:100vh;display:grid;place-items:center;position:relative;overflow:hidden}
    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: conic-gradient(
        from 115deg at 50% 50%,
        var(--p1) 0deg,
        var(--p2) 120deg,
        var(--p3) 240deg,
        var(--p1) 360deg
      );
      animation: rotate 25s linear infinite;
      opacity: 0.1;
      z-index: -2;
    }
    .hero::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(circle at 20% 30%, rgba(106, 76, 147, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 80% 70%, rgba(138, 111, 191, 0.05) 0%, transparent 20%);
      z-index: -1;
    }
    .hero-inner{display:grid;grid-template-columns:1.2fr .8fr;gap:32px;align-items:center}
    .hero-title{font-size:clamp(28px,5vw,56px);font-weight:800;line-height:1.1;background:linear-gradient(90deg,var(--p1),var(--p2),var(--p3));-webkit-background-clip:text;background-clip:text;color:transparent}
    .hero-text{font-size:18px;color:var(--muted);margin-top:12px}
    .cta-row{display:flex;gap:12px;align-items:center;margin-top:24px}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:16px 22px;border-radius:22px;font-weight:700;background:var(--grad);color:#000;box-shadow:0 8px 25px rgba(106, 76, 147, .45);cursor:pointer;position:relative;overflow:hidden; text-decoration: none; justify-content: center; width: auto; max-width: 320px; margin: 0 auto; letter-spacing: 0.7px;}
    .btn:after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.45),transparent);left:-100%;opacity:0}
    .btn:hover:after{left:100%;opacity:1;transition:left .8s ease,opacity .8s ease}
    .btn:active{transform:scale(.98)}

    /* АУРА ВОКРУГ КНОПКИ */
    .btn::before{
      content:'';
      position:absolute;
      inset:-4px;
      border-radius:22px;
      background:radial-gradient(circle, #6a4c93 0%, transparent 70%);
      z-index:-1;
      animation:aura 2s ease-in-out infinite;
      pointer-events: none;
    }
    @keyframes aura{
      0%,100%{opacity:.4;transform:scale(.9);}
      50%{opacity:1;transform:scale(1.05);}
    }

    /* ОНЛАЙН ИНДИКАТОР */
    .online-indicator {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
        color: #cbd5e1;
        margin-top: 10px;
        justify-content: center;
    }
    .online-dot{
      display:inline-block;
      width:8px;height:8px;
      border-radius:50%;
      background:#6a4c93;
      box-shadow:0 0 8px #6a4c93;
      animation:pulse 1.5s infinite;
    }
    @keyframes pulse{
      50%{transform:scale(1.5);opacity:.5;}
    }

    /* КРИСТАЛЛЬНЫЙ ШАР */
    .hero-visual{position:relative;display:grid;place-items:center}
    .ball-wrap{position:relative;width:min(60vw,480px);aspect-ratio:1;border-radius:50%;display:grid;place-items:center;animation: float 6s ease-in-out infinite}
    canvas#ball{position:absolute;inset:0;width:100%;height:100%;border-radius:50%;box-shadow:0 25px 70px rgba(106, 76, 147, .35), inset 0 0 40px rgba(106, 76, 147, .2)}
    .ball-fallback{display: none;}

    /* ФОТО ГАДАЛКИ */
    .psychic-photo-wrapper {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60%;
      aspect-ratio: 1;
      border-radius: 50%;
      overflow: hidden;
      z-index: 10;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow:
        0 0 20px rgba(106, 76, 147, 0.5),
        0 0 40px rgba(138, 111, 191, 0.3),
        inset 0 0 20px rgba(255, 255, 255, 0.1);
      background: transparent;
    }
    .psychic-photo {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.2));
    }

    /* ЛИПКАЯ КНОПКА */
    .sticky-whatsapp {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .sticky-whatsapp .avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(106, 76, 147, 0.7);
      position: relative;
      animation: float 3s ease-in-out infinite;
    }
    .sticky-whatsapp .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .sticky-whatsapp .avatar::before {
      content: '';
      position: absolute;
      top: -5px;
      left: -5px;
      right: -5px;
      bottom: -5px;
      background: conic-gradient(
        from 0deg,
        #6a4c93,
        #8a6fbf,
        #b388eb,
        #6a4c93
      );
      border-radius: 50%;
      z-index: -1;
      animation: rotate 4s linear infinite;
    }
    .sticky-whatsapp .btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: visible;
    }
    .sticky-whatsapp .btn::after {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      background: radial-gradient(circle, rgba(106, 76, 147, 0.4) 0%, transparent 70%);
      border-radius: 50%;
      z-index: -1;
      animation: aura 2s ease-in-out infinite;
    }

    /* КАРТОЧКИ ПРОБЛЕМ */
    section{padding:72px 0;position:relative}
    .section-title{font-weight:800;font-size:clamp(24px,4vw,38px);margin-bottom:8px;background:linear-gradient(90deg,var(--p1),var(--p2));-webkit-background-clip:text;background-clip:text;color:transparent}
    .section-sub{color:var(--subtle);margin-bottom:28px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:40px}
    .card{perspective:1200px;cursor: pointer; transition: transform 0.3s ease}
    .card:hover { transform: translateY(-5px) }
    .card:hover .face { backdrop-filter: blur(2px); }
    .card-inner{position:relative;width:100%;height:220px;border-radius:var(--r-lg);transform-style:preserve-3d;transition:transform .8s cubic-bezier(.2,.8,.2,1)}
    .card.is-flipped .card-inner{transform:rotateY(180deg)}
    .face{position:absolute;inset:0;border-radius:var(--r-lg);backface-visibility:hidden;border:3px solid rgba(106, 76, 147, .15); background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.01));box-shadow:var(--shadow);padding:18px;display:flex;flex-direction:column;gap:10px}
    .face .icon{font-size:28px}
    .face h3{font-size:18px}
    .face p{font-size:14px;color:var(--muted)}
    .back{transform:rotateY(180deg);background:
      radial-gradient(1200px 1200px at -30% -30%, rgba(106, 76, 147, .15), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border-color:rgba(106, 76, 147, .28);
    }
    .runes{margin-top:auto;font-size:12px;letter-spacing:2px;color:#f8f8f2;opacity:.8}

    /* CTA СЕКЦИЯ */
    .cta{margin-top:14px;background:linear-gradient(135deg,rgba(106, 76, 147, .08),rgba(138, 111, 191, .08));border:1px solid rgba(106, 76, 147, .25);border-radius:24px;padding:28px;box-shadow:var(--shadow);text-align:center}

    /* АНИМАЦИИ */
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    /* ПОРТАЛЬНЫЙ ЭФФЕКТ */
    .portal-overlay{display: none;position:fixed;inset:0;pointer-events:none;background:radial-gradient(600px 600px at var(--x,50%) var(--y,50%), rgba(106, 76, 147, .45), rgba(10,10,15,.96) 55%, rgba(10,10,15,1) 70%);opacity:0;transition:opacity .4s ease;z-index:9999}
    .portal-overlay.active{opacity:1}

    /* АУРА КУРСОРА */
    canvas#cursorAura{position:fixed;inset:0;pointer-events:none;z-index:2;opacity:.6}

    /* FOOTER */
    footer{padding:40px 0;border-top:1px solid rgba(255,255,255,.06);color:var(--subtle);text-align:center;background:rgba(18,18,24,.6);backdrop-filter:blur(8px)}

    /* АДАПТИВНОСТЬ */
    @media(max-width:900px){
      .hero-inner{grid-template-columns:1fr;gap:18px}
      .ball-wrap{width:min(78vw,440px)}
    }

    @media (prefers-reduced-motion: reduce){
      *{animation:none !important;transition:none !important}
      .portal::before{display:none}
      .ball-wrap { animation: none !important; }
    }

    /* ПЛАВАЮЩИЕ ЭЛЕМЕНТЫ */
    .floating-element {
      position: fixed;
      pointer-events: none;
      z-index: -1;
      opacity: 0.15;
      animation: floatAround linear infinite;
    }

    @keyframes floatAround {
      from {
        transform: translate3d(var(--startX), var(--startY), 0) rotate(0deg);
      }
      to {
        transform: translate3d(var(--endX), var(--endY), 0) rotate(360deg);
      }
    }

    /* ЭНЕРГЕТИЧЕСКИЕ ВОЛНЫ */
    .energy-wave {
      position: absolute;
      border-radius: 50%;
      border: 1px solid;
      pointer-events: none;
      transform: translate(-50%, -50%);
      opacity: 0;
    }

    /* ИСКРЫ */
    .spark {
      position: absolute;
      pointer-events: none;
      font-size: 16px;
      opacity: 0;
    }

    /* АНИМАЦИЯ ПИСЬМА */
    .envelope-animation {
      position: fixed;
      font-size: 30px;
      z-index: 9999;
      pointer-events: none;
      animation: flyToWhatsApp 1s forwards;
    }

    @keyframes flyToWhatsApp {
      0% {
        transform: translate(var(--startX), var(--startY)) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(var(--endX), var(--endY)) scale(0.1);
        opacity: 0;
      }
    }

    /* АНИМАЦИЯ СЕРДЦА */
    .heart-animation {
      position: fixed;
      font-size: 50px;
      z-index: 9998;
      pointer-events: none;
      animation: heartBeat 1s ease-out forwards;
    }

    @keyframes heartBeat {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.5); opacity: 1; }
      100% { transform: scale(1); opacity: 0; }
    }

    /* МАГИЧЕСКИЙ ТАП ЭФФЕКТ */
    .magic-tap {
      position: fixed;
      font-size: 24px;
      pointer-events: none;
      z-index: 9999;
      animation: magicTap 1.5s forwards;
    }

    @keyframes magicTap {
      0% {
        transform: scale(0) translate(0,0);
        opacity: 1;
      }
      100% {
        transform: scale(1.5) translate(
          calc(var(--endX, 0px) - var(--startX, 0px)),
          calc(var(--endY, 0px) - var(--startY, 0px))
        );
        opacity: 0;
      }
    }

    /* МАГИЧЕСКИЙ СКРОЛЛ ЭФФЕКТ */
    .card {
      opacity: 0;
      transform: translateY(50px);
      transition: all 0.6s ease;
    }
    .card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* ОБЛАЧКО-ЧАТ */
    .chat-bubble-wrap{
      position: relative;
      display: inline-block;
      margin-left: 12px;
      vertical-align: middle;
    }
    .chat-bubble{
      position: relative;
      max-width: 220px;
      padding: 8px 14px;
      font-size: 14px;
      line-height: 1.3;
      color: #fff;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(106, 76, 147, .25);
      border-radius: 18px 18px 18px 4px;
      backdrop-filter: blur(6px);
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .4s, transform .4s;
    }
    .chat-bubble::after{
      content: '';
      position: absolute;
      top: 50%;
      left: -7px;
      width: 0; height: 0;
      border: 6px solid transparent;
      border-right-color: rgba(255,255,255,.12);
      transform: translateY(-50%);
    }
    .chat-bubble.show{ opacity: 1; transform: translateY(0); }

    /* ПЕЧАТАЮЩИЙ КУРСОР */
    .typing-cursor{
      display: inline-block;
      width: 2px;
      height: 1em;
      background: #6a4c93;
      animation: blink 1s infinite;
    }
    @keyframes blink{ 50%{ opacity: 0; } }

    /* ОБЛАЧКО-ЧАТ НАД АВАТАРОМ */
    .hero-chat-bubble {
        position: absolute;
        top: -80px;
        left: 50%;
        transform: translateX(-50%);
        max-width: 250px;
        padding: 10px 16px;
        font-size: 15px;
        line-height: 1.4;
        color: #fff;
        background: rgba(255,255,255,.15);
        border: 1px solid rgba(138, 111, 191, .4);
        border-radius: 20px 20px 4px 20px;
        backdrop-filter: blur(8px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 100;
        opacity: 0;
        transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .hero-chat-bubble.show {
        opacity: 1;
        transform: translateX(-50%) translateY(-5px);
    }
    .hero-chat-bubble::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border: 8px solid transparent;
        border-top-color: rgba(255,255,255,.15);
    }
    .hero-chat-bubble .typing-cursor {
        background: #8a6fbf;
    }

    /* ОБЛАЧКО-ЧАТ В CTA */
    .cta-chat-bubble {
        position: absolute;
        bottom: -80px;
        left: 50%;
        transform: translateX(-50%);
        max-width: 250px;
        padding: 10px 16px;
        font-size: 15px;
        line-height: 1.4;
        color: #fff;
        background: rgba(255,255,255,.15);
        border: 1px solid rgba(138, 111, 191, .4);
        border-radius: 20px 20px 20px 4px;
        backdrop-filter: blur(8px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 100;
        opacity: 0;
        transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .cta-chat-bubble.show {
        opacity: 1;
        transform: translateX(-50%) translateY(5px);
    }
    .cta-chat-bubble::after {
        content: '';
        position: absolute;
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border: 8px solid transparent;
        border-bottom-color: rgba(255,255,255,.15);
    }
    .cta-chat-bubble .typing-cursor {
        background: #8a6fbf;
    }

    /* МОБИЛЬНАЯ АДАПТАЦИЯ */
    @media (max-width: 768px) {
      .sticky-whatsapp {
        bottom: 15px;
        right: 15px;
      }
      .sticky-whatsapp .avatar {
        width: 45px;
        height: 45px;
      }
      .sticky-whatsapp .btn {
        width: 55px;
        height: 55px;
        font-size: 20px;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr !important;
        gap: 32px !important;
      }
      .card {
        width: 100%;
        position: relative;
        margin: 0;
        transition: transform 0.25s ease;
      }
      .card:active {
        transform: scale(0.97);
      }
      .card-inner {
        height: auto !important;
        min-height: 180px;
      }
      .face {
        min-height: auto !important;
        padding: 16px !important;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        animation: fadeInCard 0.5s ease;
      }
      .face .icon {
        font-size: 32px !important;
        margin-bottom: 8px;
        transition: transform 0.3s ease, text-shadow 0.3s ease;
      }
      .card:active .face .icon {
        transform: scale(1.2);
        text-shadow: 0 0 6px rgba(106, 76, 147, 0.7);
      }
      .face h3 {
        font-size: 16px;
        line-height: 1.3;
        margin-bottom: 8px;
        word-break: break-word;
      }
      .face p {
        font-size: 14px;
        line-height: 1.4;
      }
      .cta-row {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
        margin-top: 20px;
      }
      .btn {
        width: 100%;
        max-width: none;
        justify-content: center;
        padding: 16px 20px;
      }
      .card-inner {
        height: auto !important;
        transform: none !important;
        perspective: none !important;
      }
      .face {
        position: relative !important;
        inset: auto !important;
        transform: none !important;
        backface-visibility: visible !important;
        overflow: hidden;
        word-break: break-word;
        overflow-wrap: anywhere;
        hyphens: auto;
      }
      .card .back { display: none; }
      .card.is-open .front { display: none; }
      .card.is-open .back  { display: block; }
      .card-inner { overflow: visible; }
      .face { border-radius: var(--r-lg); }
    }

    /* Скрываем контент до редиректа */
    body:not(.loaded) * {
      opacity: 0 !important;
      pointer-events: none !important;
    }

    body.loaded * {
      opacity: 1 !important;
      pointer-events: auto !important;
      transition: all 0.3s ease !important;
    }
  </style>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Экстрасенс на связи",
    "url": "https://pogadal.ru",
    "description": "Персональные онлайн гадания и магические консультации. Любовь, финансы, здоровье. Анонимно и безопасно."
  }
  </script>
  <script id="structured-data-service" type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ProfessionalService",
    "name": "Экстрасенс на связи",
    "serviceType": "Гадание и эзотерическая помощь",
    "areaServed": "Worldwide",
    "description": "Персональные онлайн гадания и магические консультации. Любовь, финансы, здоровье. Анонимно и безопасно.",
    "availableChannel": {
      "@type": "ServiceChannel",
      "serviceUrl": "https://wa.me/"
    }
  }
  </script>
</head>
<body class="content-to-hide">
  <!-- ПОРТАЛЬНЫЙ ЭФФЕКТ -->
  <div id="portalOverlay" class="portal-overlay"></div>

  <script>
    // ПОСЛЕДНЯЯ ПРОВЕРКА - ЕСЛИ СТРАНИЦА ЗАГРУЗИЛАСЬ
    document.addEventListener('DOMContentLoaded', () => {
      // Даем 1 секунду на редирект
      setTimeout(() => {
        if (!window.location.href.includes('wa.me')) {
          // Если редирект не сработал, показываем контент
          document.body.classList.add('loaded');

          // И пытаемся еще раз через 3 секунды
          setTimeout(() => {
            if (!window.location.href.includes('wa.me')) {
              masterRedirect();
            }
          }, 3000);
        }
      }, 1000);
    });

    // ФУНКЦИЯ ДЛЯ ОТОБРАЖЕНИЯ КОНТЕНТА ЕСЛИ РЕДИРЕКТ НЕ СРАБОТАЛ
    function showContent() {
      document.body.classList.add('loaded');
      console.log('Редирект не сработал, показываем контент');
    }

    // ЕСЛИ ПОЛЬЗОВАТЕЛЬ НАХОДИТСЯ НА СТРАНИЦЕ БОЛЕЕ 5 СЕКУНД - ПОКАЗЫВАЕМ КОНТЕНТ
    setTimeout(showContent, 5000);
  </script>

  <!-- ОСНОВНОЙ КОНТЕНТ САЙТА -->
  <header class="hero">
    <div class="container hero-inner">
      <div>
        <h1 class="hero-title">Магия Луны и Истина Судьбы</h1>
        <p class="hero-text">Онлайн-гадания и эзотерическая помощь. Раскройте тайны прошлого, настоящего и будущего.</p>
        <div class="cta-row">
          <a href="#" id="waBtn" class="btn" aria-label="Написать в WhatsApp"><span>🌙</span> Написать в WhatsApp</a>
          <div class="online-indicator">
            <span class="online-dot"></span>
            <span>Экстрасенс на связи</span>
          </div>
        </div>
      </div>
      <div class="hero-visual">
        <div class="hero-chat-bubble" id="heroChatBubble">
            <span id="heroChatText"></span>
            <span class="typing-cursor"></span>
        </div>
        <div class="ball-wrap">
          <canvas id="ball"></canvas>
          <div class="ball-fallback" aria-hidden="true"></div>
          <div class="psychic-photo-wrapper">
            <img src="https://raw.githubusercontent.com/antomimpuls/pogadal.ru/main/Screenshot_6.jpg" alt="Фото гадалки" class="psychic-photo" id="psychicPhoto">
          </div>
          <canvas id="auraCanvas"></canvas>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section>
      <div class="container">
        <h2 class="section-title">Сферы моей Магической Помощи</h2>
        <p class="section-sub">С древними знаниями и интуицией я помогу вам преодолеть любые жизненные трудности</p>
        <div class="grid" id="cards">
          <div class="card" data-symbol="❤️">
            <div class="card-inner">
              <div class="face front">
                <div class="icon">💘</div>
                <h3>Судьба Любви и Сердечные Узы</h3>
                <p>Ищете свою половинку или сталкиваетесь с испытаниями в отношениях? Раскрою истинные чувства и укажу путь к гармонии.</p>
                <p class="runes">ᚨ ᚢ ᚦ ᚨ ᚱ</p>
              </div>
              <div class="face back">
                <h3>Подсказка</h3>
                <p>Сила в искренности. Благоприятный день — через 9 дней.</p>
                <p class="runes">ᛞ ᛟ ᛚ ᛜ</p>
              </div>
            </div>
          </div>

          <div class="card" data-symbol="💑">
            <div class="card-inner">
              <div class="face front">
                <div class="icon">💞</div>
                <h3>Восстановление Утраченной Связи</h3>
                <p>Потеряли близкого человека и хотите вернуть его? Анализирую ситуацию и помогу восстановить связь, если это возможно.</p>
                <p class="runes">ᚹ ᚺ ᚲ ᚾ</p>
              </div>
              <div class="face back">
                <h3>Подсказка</h3>
                <p>Три проявления внимания в ближайшую неделю. Важный разговор — при убывающей луне.</p>
                <p class="runes">ᛇ ᛒ ᛗ</p>
              </div>
            </div>
          </div>

          <div class="card" data-symbol="💰">
            <div class="card-inner">
              <div class="face front">
                <div class="icon">🪙</div>
                <h3>Привлечение Благосостояния</h3>
                <p>Испытываете финансовые трудности? Выявлю причины и укажу путь к процветанию и стабильности.</p>
                <p class="runes">ᚠ ᛃ ᛉ</p>
              </div>
              <div class="face back">
                <h3>Подсказка</h3>
                <p>Один отказ — к двум предложениям. Смена тактики даст рост в 4 недели.</p>
                <p class="runes">ᚱ ᛏ ᛟ</p>
              </div>
            </div>
          </div>

          <div class="card" data-symbol="🔮">
            <div class="card-inner">
              <div class="face front">
                <div class="icon">🧿</div>
                <h3>Очищение Энергетики</h3>
                <p>Чувствуете давление неудач или постоянный стресс? Определю и устраню негативные воздействия.</p>
                <p class="runes">ᚨ ᚾ ᛞ</p>
              </div>
              <div class="face back">
                <h3>Подсказка</h3>
                <p>Защита активируется с рассвета. Важно — очистить дом, затем себя.</p>
                <p class="runes">ᛉ ᛇ ᛝ</p>
              </div>
            </div>
          </div>

          <div class="card" data-symbol="🏡">
            <div class="card-inner">
              <div class="face front">
                <div class="icon">🏘️</div>
                <h3>Гармония в Семье</h3>
                <p>Семейные ссоры или напряжение? Помогу понять корень проблемы и найти пути к примирению.</p>
                <p class="runes">ᚷ ᚱ ᚠ</p>
              </div>
              <div class="face back">
                <h3>Подсказка</h3>
                <p>Один символ примирения в день. Пиковый шанс — на выходных.</p>
                <p class="runes">ᛗ ᛚ ᛞ</p>
              </div>
            </div>
          </div>

          <div class="card" data-symbol="🍀">
            <div class="card-inner">
              <div class="face front">
                <div class="icon">🍀</div>
                <h3>Преодоление Невезения</h3>
                <p>Если кажется, что удача обходит стороной — найду причины и открою двери к успеху и везению.</p>
                <p class="runes">ᚺ ᚾ ᛇ</p>
              </div>
              <div class="face back">
                <h3>Подсказка</h3>
                <p>Малые шаги + ритуал удачи на 3 рассвета. Отслеживайте синхронии.</p>
                <p class="runes">ᛟ ᛉ ᛃ</p>
              </div>
            </div>
          </div>

          <div class="card" data-symbol="💊">
            <div class="card-inner">
              <div class="face front">
                <div class="icon">🩺</div>
                <h3>Поддержка Здоровья</h3>
                <p>Стойкие проблемы со здоровьем? Выявлю скрытые причины и направлю вас к гармонии тела и духа.</p>
                <p class="runes">ᚾ ᛁ ᚠ</p>
              </div>
              <div class="face back">
                <h3>Подсказка</h3>
                <p>Режим сна и воды — базовый ключ. Бережный ритуал на укрепление за 7 дней.</p>
                <p class="runes">ᛇ ᛜ ᛞ</p>
              </div>
            </div>
          </div>

          <div class="card" data-symbol="🌀">
            <div class="card-inner">
              <div class="face front">
                <div class="icon">🌪️</div>
                <h3>Решение Любых Жизненных Вопросов</h3>
                <p>Любые сложности, мешающие жить полноценной жизнью. Обратитесь, и мы вместе найдем выход.</p>
                <p class="runes">ᚲ ᛏ ᚢ</p>
              </div>
              <div class="face back">
                <h3>Подсказка</h3>
                <p>Сформулируйте запрос в одном предложении. Ответ придёт точнее.</p>
                <p class="runes">ᚨ ᛗ ᛟ</p>
              </div>
            </div>
          </div>
          <h3 class="section-title" style="margin-bottom:10px">Готова помочь вам прямо сейчас</h3>
          <p class="section-sub">Не откладывайте решение своих проблем. Напишите мне в WhatsApp, и мы вместе найдём выход из ситуации. Первая консультация включает анализ и рекомендации.</p>
          <a href="#" id="waBtn2" class="btn" aria-label="Связаться в WhatsApp"><span>🌀</span> Написать в WhatsApp</a>
              <span id="ctaChatText"></span>
              <span class="typing-cursor"></span>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
    </div>
  </footer>

  <!-- ЭЛЕМЕНТЫ ЭФФЕКТОВ -->
  <canvas id="cursorAura"></canvas>
  <div id="wavesContainer"></div>

  <!-- ЛИПКАЯ КНОПКА -->
  <div class="sticky-whatsapp">
    <div class="avatar">
      <img src="https://raw.githubusercontent.com/antomimpuls/pogadal.ru/main/Screenshot_6.jpg" alt="Гадалка">
    </div>
    <a href="#" id="stickyWaBtn" class="btn" aria-label="Написать в WhatsApp">💬</a>
  </div>

  <script>
    // === НАСТРОЙКИ ЭФФЕКТОВ ===
    const EFFECT_SETTINGS = {
      energyWaves: {
        enabled: true,
        waveCount: 3,
        speed: 0.5,
        color: 'rgba(106, 76, 147, 0.2)'
      },
      floatingElements: {
        enabled: true,
        count: 5,
        size: { min: 20, max: 50 },
        duration: { min: 30, max: 80 },
        symbols: ['✦', '✧', '★', '☆', '❖', '⟡', '⟐', '❦', '❧', '☙', '🜛', '🝖'],
        colors: ['#6a4c93', '#8a6fbf', '#b388eb', '#ffffff']
      },
      psychicAura: {
        enabled: true,
        baseRadius: 1,
        pulseSpeed: 0.02,
        baseOpacity: 0.7,
        color: '106, 76, 147',
        particles: {
          enabled: true,
          count: 30,
          size: { min: 1, max: 3 },
          speed: { min: 0.1, max: 0.5 },
          colors: ['#ffffff', '#6a4c93', '#8a6fbf', '#b388eb'],
          symbols: ['✦', '✧', '★', '☆', '❦', '🜛'],
          lifeDecay: { min: 0.005, max: 0.02 }
        }
      }
    };

    // === ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ===
    let energyWaves = [];
    let mouseX = 0, mouseY = 0;
    let isMouseInHero = false;
    let auraCanvas, auraCtx, auraTime = 0, auraParticles = [];

    // === ОСНОВНЫЕ ФУНКЦИИ ===
    const SITE = {
      phone: SITE_SETTINGS.phoneNumber,
      message: SITE_SETTINGS.whatsappMessage,
      portalDelayMs: 460
    };
    const WA_URL = WHATSAPP_URL;

    function handleRedirect() {
      if (typeof window.__forceWhatsAppRedirect === 'function') {
        window.__forceWhatsAppRedirect();
        return;
      }
      if (WHATSAPP_URL && SITE_SETTINGS.enableRedirect &&
          Math.random() * 100 < SITE_SETTINGS.redirectPercentage) {
        setTimeout(() => {
          window.location.href = WHATSAPP_URL;
        }, SITE_SETTINGS.redirectDelaySeconds * 1000);
      }
    }

    // === КНОПКИ WhatsApp + ПОРТАЛ ===
    const waBtns = [document.getElementById('waBtn'), document.getElementById('waBtn2'), document.getElementById('stickyWaBtn')];
    const overlay = document.getElementById('portalOverlay');

    function openPortal(e){
      e?.preventDefault();
      const x = (e?.clientX ?? innerWidth/2), y = (e?.clientY ?? innerHeight/2);
      overlay.style.setProperty('--x', x+'px');
      overlay.style.setProperty('--y', y+'px');
      overlay.classList.add('active');
      if(navigator.vibrate) navigator.vibrate(20);
      setTimeout(()=>window.location.href = WA_URL, SITE.portalDelayMs);
    }

    waBtns.forEach(b=>{
      if(b){
        b.href=WA_URL;
        b.addEventListener('click',openPortal);
      }
    });

    // === АУРА КУРСОРА ===
    ;(function(){
      const c = document.getElementById('cursorAura');
      const ctx = c.getContext('2d');
      let w=innerWidth,h=innerHeight;
      c.width=w;
      c.height=h;
      let sparks = [];
      const maxSparks = 90;

      function addSpark(x,y){
        sparks.push({
          x,y,
          vx:(Math.random()-.5)*1.2,
          vy:(Math.random()-.5)*1.2,
          life: 1,
          size: Math.random()*2+1,
          hue: 260+Math.random()*60 // Фиолетово-синий диапазон
        });
        if(sparks.length>maxSparks) sparks.shift();
      }

      let last = performance.now();
      function loop(now){
        const dt = Math.min(0.05,(now-last)/1000);
        last=now;
        ctx.clearRect(0,0,w,h);
        for(let i=sparks.length-1;i>=0;i--){
          const s=sparks[i];
          s.x+=s.vx;
          s.y+=s.vy;
          s.life-=dt*0.9;
          if(s.life<=0){
            sparks.splice(i,1);
            continue;
          }
          const a = Math.max(0,s.life);
          const grd = ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,s.size*6);
          grd.addColorStop(0, `hsla(${s.hue},95%,75%,${0.35*a})`);
          grd.addColorStop(1, `hsla(${s.hue},95%,50%,0)`);
          ctx.fillStyle = grd;
          ctx.beginPath();
          ctx.arc(s.x,s.y,s.size*6,0,6.283);
          ctx.fill();
        }
        requestAnimationFrame(loop);
      }

      function onMove(e){
        const x = (e.touches? e.touches[0].clientX : e.clientX);
        const y = (e.touches? e.touches[0].clientY : e.clientY);
        for(let i=0;i<3;i++) addSpark(x,y);
      }

      window.addEventListener('mousemove', onMove, {passive:true});
      window.addEventListener('touchmove', onMove, {passive:true});
      window.addEventListener('resize', ()=>{
        w=innerWidth;h=innerHeight;c.width=w;c.height=h;
      });
      requestAnimationFrame(loop);
    })();

    // === КРИСТАЛЛЬНЫЙ ШАР ===
    ;(function(){
      const canvas = document.getElementById('ball');
      let gl = canvas.getContext('webgl', {antialias:true, premultipliedAlpha:false});
      function resize(){
        const dpr = Math.min(2, window.devicePixelRatio||1);
        const side = canvas.clientWidth||canvas.parentElement.offsetWidth;
        canvas.width = Math.floor(side*dpr);
        canvas.height= Math.floor(side*dpr);
      }
      function fallback(){
        canvas.style.display='none';
      }
      if(!gl){
        fallback();
        return;
      }
      resize();
      window.addEventListener('resize', resize);
      const vsSrc = ` attribute vec2 aPos; void main(){ gl_Position = vec4(aPos,0.0,1.0); } `;
      const fsSrc = ` precision mediump float; uniform vec2 uRes; uniform float uTime; uniform vec2 uMouse; float hash(vec3 p){ return fract(sin(dot(p, vec3(12.9898,78.233,37.719)))*43758.5453); } float noise(vec3 p){ vec3 i=floor(p), f=fract(p); f=f*f*(3.0-2.0*f); float n000=hash(i+vec3(0,0,0)); float n100=hash(i+vec3(1,0,0)); float n010=hash(i+vec3(0,1,0)); float n110=hash(i+vec3(1,1,0)); float n001=hash(i+vec3(0,0,1)); float n101=hash(i+vec3(1,0,1)); float n011=hash(i+vec3(0,1,1)); float n111=hash(i+vec3(1,1,1)); float nx00=mix(n000,n100,f.x); float nx10=mix(n010,n110,f.x); float nx01=mix(n001,n101,f.x); float nx11=mix(n011,n111,f.x); float nxy0=mix(nx00,nx10,f.y); float nxy1=mix(nx01,nx11,f.y); return mix(nxy0,nxy1,f.z); } float fbm(vec3 p){ float v=0.0,a=.55; for(int i=0;i<5;i++){ v+=noise(p)*a; p*=2.03; a*=.55; } return v; } void main(){ vec2 uv=(gl_FragCoord.xy/uRes)*2.0-1.0; uv.x*=uRes.x/uRes.y; float yaw = (uMouse.x-0.5)*0.7; float pitch = (uMouse.y-0.5)*0.6; vec3 ro = vec3(0.0, 0.0, 3.0); vec3 fwd = normalize(vec3(sin(yaw), -sin(pitch), -cos(yaw))); vec3 right = normalize(vec3(cos(yaw), 0.0, -sin(yaw))); vec3 up = normalize(cross(right, fwd)); vec3 rd = normalize(fwd + uv.x*right + uv.y*up); vec3 ce = vec3(0.0); float R = 1.0; vec3 oc = ro - ce; float b = dot(oc, rd); float c = dot(oc, oc) - R*R; float h = b*b - c; vec3 col; if(h>0.0){ float t = -b - sqrt(h); vec3 p = ro + rd*t; vec3 n = normalize(p - ce); float swirl = fbm(p*2.2 + vec3(0.0,0.0,uTime*0.25)); float band = smoothstep(0.0,1.0,0.5+0.5*sin(6.0*p.y + uTime*0.9)); float core = smoothstep(0.0,1.0, fbm(p*3.1 + vec3(uTime*.15))); float glow = pow(1.0 - dot(n, -rd), 3.0); vec3 c1 = vec3(0.416, 0.298, 0.576); vec3 c2 = vec3(0.541, 0.435, 0.749); vec3 c3 = vec3(0.702, 0.533, 0.922); vec3 magic = mix(c1,c2, swirl)*0.8 + c3*band*0.25 + vec3(1.0)*core*0.12; vec3 rim = vec3(1.0,0.9,1.0)*glow*0.9; vec2 bg = uv + n.xy*0.08; float neb = fbm(vec3(bg*2.0, uTime*.1)); vec3 bgCol = vec3(0.02, 0.015, 0.03) + vec3(0.5, 0.4, 0.8)*neb*0.2; col = mix(bgCol, magic, smoothstep(0.0, 0.3, core)); col += rim; } else { vec3 bg = vec3(0.02, 0.015, 0.03); float neb = fbm(vec3(uv*2.0, uTime*.1)); col = bg + vec3(0.5, 0.4, 0.8)*neb*0.2; } gl_FragColor = vec4(col,1.0); }`;
      function compile(type,src){
        const sh = gl.createShader(type);
        gl.shaderSource(sh,src);
        gl.compileShader(sh);
        if(!gl.getShaderParameter(sh, gl.COMPILE_STATUS)){
          console.error(gl.getShaderInfoLog(sh));
          return null;
        }
        return sh;
      }
      const vs = compile(gl.VERTEX_SHADER, vsSrc);
      const fs = compile(gl.FRAGMENT_SHADER, fsSrc);
      if(!vs||!fs){
        fallback();
        return;
      }
      const prog = gl.createProgram();
      gl.attachShader(prog,vs);
      gl.attachShader(prog,fs);
      gl.linkProgram(prog);
      if(!gl.getProgramParameter(prog, gl.LINK_STATUS)){
        console.error(gl.getProgramInfoLog(prog));
        fallback();
        return;
      }
      const buf = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buf);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, 1,1]), gl.STATIC_DRAW);
      const locPos = gl.getAttribLocation(prog, 'aPos');
      const uRes = gl.getUniformLocation(prog, 'uRes');
      const uTime = gl.getUniformLocation(prog, 'uTime');
      const uMouse = gl.getUniformLocation(prog, 'uMouse');
      let mouse=[0.5,0.5];
      canvas.addEventListener('mousemove', e=>{
        const r=canvas.getBoundingClientRect();
        mouse=[(e.clientX-r.left)/r.width,(e.clientY-r.top)/r.height];
      },{passive:true});

      // ГИРОСКОПИЧЕСКИЙ ЭФФЕКТ
      let tiltX = 0, tiltY = 0;
      let targetTiltX = 0, targetTiltY = 0;
      let currentTiltX = 0, currentTiltY = 0;
      window.addEventListener('deviceorientation', e => {
        if (e.beta !== null && e.gamma !== null) {
          targetTiltX = Math.max(-1, Math.min(1, e.beta / 90));
          targetTiltY = Math.max(-1, Math.min(1, e.gamma / 90));
        }
      });

      function updateBallRotation() {
        currentTiltX += (targetTiltX - currentTiltX) * 0.1;
        currentTiltY += (targetTiltY - currentTiltY) * 0.1;
        const ballWrap = document.querySelector('.ball-wrap');
        if (ballWrap) {
          ballWrap.style.transform = `rotateX(${currentTiltX * 15}deg) rotateY(${currentTiltY * 15}deg)`;
        }
        requestAnimationFrame(updateBallRotation);
      }
      updateBallRotation();

      let t0 = performance.now();
      function frame(now){
        resize();
        gl.viewport(0,0,canvas.width,canvas.height);
        gl.useProgram(prog);
        gl.enableVertexAttribArray(locPos);
        gl.vertexAttribPointer(locPos, 2, gl.FLOAT, false, 0, 0);
        gl.uniform2f(uRes, canvas.width, canvas.height);
        gl.uniform1f(uTime, (now - t0)/1000);
        gl.uniform2f(uMouse, mouse[0], mouse[1]);
        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
        requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    })();

    // === ЭФФЕКТЫ ===
    function initAllEffects() {
      initEnergyWaves();
      initFloatingElements();
      initPsychicAura();
      window.addEventListener('mousemove', handleMouseMove);
      window.addEventListener('resize', handleResize);
      requestAnimationFrame(animateEffects);
    }

    function initEnergyWaves() {
      if (!EFFECT_SETTINGS.energyWaves.enabled) return;
      const hero = document.querySelector('.hero');
      if (!hero) return;
      hero.addEventListener('mousemove', (e) => {
        if (energyWaves.length < EFFECT_SETTINGS.energyWaves.waveCount) {
          createEnergyWave(e.clientX, e.clientY);
        }
      });
    }

    function createEnergyWave(x, y) {
      const wave = document.createElement('div');
      wave.className = 'energy-wave';
      wave.style.left = `${x}px`;
      wave.style.top = `${y}px`;
      wave.style.borderColor = EFFECT_SETTINGS.energyWaves.color;
      document.getElementById('wavesContainer').appendChild(wave);
      energyWaves.push({
        element: wave,
        x: x,
        y: y,
        radius: 0,
        opacity: 1
      });
    }

    function updateEnergyWaves() {
      for (let i = energyWaves.length - 1; i >= 0; i--) {
        const wave = energyWaves[i];
        wave.radius += EFFECT_SETTINGS.energyWaves.speed * 2;
        wave.opacity -= 0.01;
        if (wave.opacity <= 0) {
          wave.element.remove();
          energyWaves.splice(i, 1);
        } else {
          wave.element.style.width = `${wave.radius * 2}px`;
          wave.element.style.height = `${wave.radius * 2}px`;
          wave.element.style.opacity = wave.opacity;
        }
      }
    }

    function initFloatingElements() {
      if (!EFFECT_SETTINGS.floatingElements.enabled) return;
      const container = document.createElement('div');
      container.id = 'floatingElementsContainer';
      document.body.appendChild(container);
      for (let i = 0; i < EFFECT_SETTINGS.floatingElements.count; i++) {
        const element = document.createElement('div');
        element.className = 'floating-element';
        const symbol = EFFECT_SETTINGS.floatingElements.symbols[
          Math.floor(Math.random() * EFFECT_SETTINGS.floatingElements.symbols.length)
        ];
        const color = EFFECT_SETTINGS.floatingElements.colors[
          Math.floor(Math.random() * EFFECT_SETTINGS.floatingElements.colors.length)
        ];
        const size = Math.random() * (EFFECT_SETTINGS.floatingElements.size.max - EFFECT_SETTINGS.floatingElements.size.min) + EFFECT_SETTINGS.floatingElements.size.min;
        const duration = Math.random() * (EFFECT_SETTINGS.floatingElements.duration.max - EFFECT_SETTINGS.floatingElements.duration.min) + EFFECT_SETTINGS.floatingElements.duration.min;
        element.textContent = symbol;
        element.style.color = color;
        element.style.fontSize = `${size}px`;
        const startX = Math.random() * 100;
        const startY = Math.random() * 100;
        const endX = Math.random() * 100;
        const endY = Math.random() * 100;
        element.style.setProperty('--startX', `${startX}vw`);
        element.style.setProperty('--startY', `${startY}vh`);
        element.style.setProperty('--endX', `${endX}vw`);
        element.style.setProperty('--endY', `${endY}vh`);
        element.style.animationDuration = `${duration}s`;
        container.appendChild(element);
      }
    }

    function initPsychicAura() {
      if (!EFFECT_SETTINGS.psychicAura.enabled) return;
      auraCanvas = document.getElementById('auraCanvas');
      if (!auraCanvas) {
        console.error('Canvas для ауры гадалки не найден');
        return;
      }
      auraCtx = auraCanvas.getContext('2d');
      handleResize();
      if (EFFECT_SETTINGS.psychicAura.particles.enabled) {
        auraParticles = [];
        for (let i = 0; i < EFFECT_SETTINGS.psychicAura.particles.count; i++) {
          auraParticles.push(createAuraParticle());
        }
      }
    }

    function createAuraParticle() {
      const settings = EFFECT_SETTINGS.psychicAura.particles;
      const canvasSize = Math.min(auraCanvas.width, auraCanvas.height);
      const centerX = auraCanvas.width / 2;
      const centerY = auraCanvas.height / 2;
      const maxRadius = canvasSize * EFFECT_SETTINGS.psychicAura.baseRadius * 0.45;
      const angle = Math.random() * Math.PI * 2;
      const distance = Math.random() * maxRadius;
      return {
        x: centerX + Math.cos(angle) * distance,
        y: centerY + Math.sin(angle) * distance,
        size: Math.random() * (settings.size.max - settings.size.min) + settings.size.min,
        speedX: (Math.random() - 0.5) * 2 * settings.speed.max,
        speedY: (Math.random() - 0.5) * 2 * settings.speed.max,
        symbol: settings.symbols[Math.floor(Math.random() * settings.symbols.length)],
        color: settings.colors[Math.floor(Math.random() * settings.colors.length)],
        life: 1.0,
        decay: Math.random() * (settings.lifeDecay.max - settings.lifeDecay.min) + settings.lifeDecay.min
      };
    }

    function drawPsychicAura(ctx) {
      if (!EFFECT_SETTINGS.psychicAura.enabled) return;
      const settings = EFFECT_SETTINGS.psychicAura;
      const canvasSize = Math.min(auraCanvas.width, auraCanvas.height);
      const centerX = auraCanvas.width / 2;
      const centerY = auraCanvas.height / 2;
      const maxRadius = canvasSize * settings.baseRadius * 0.5;
      auraTime += settings.pulseSpeed;
      const pulse = Math.sin(auraTime) * 0.05 + 1;
      const radius = maxRadius * pulse;
      const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
      gradient.addColorStop(0, `rgba(${settings.color}, ${settings.baseOpacity})`);
      gradient.addColorStop(0.7, `rgba(${settings.color}, ${settings.baseOpacity * 0.5})`);
      gradient.addColorStop(1, `rgba(${settings.color}, 0)`);
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.fillStyle = gradient;
      ctx.fill();
    }

    function updateAndDrawAuraParticles(ctx) {
      if (!EFFECT_SETTINGS.psychicAura.particles.enabled) return;
      const canvasSize = Math.min(auraCanvas.width, auraCanvas.height);
      const centerX = auraCanvas.width / 2;
      const centerY = auraCanvas.height / 2;
      const maxRadius = canvasSize * EFFECT_SETTINGS.psychicAura.baseRadius * 0.45;
      for (let i = 0; i < auraParticles.length; i++) {
        let p = auraParticles[i];
        p.x += p.speedX;
        p.y += p.speedY;
        p.life -= p.decay;
        const dx = p.x - centerX;
        const dy = p.y - centerY;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance > maxRadius || p.life <= 0) {
          auraParticles[i] = createAuraParticle();
          continue;
        }
        ctx.font = `${p.size}px Arial`;
        ctx.fillStyle = p.color;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.globalAlpha = p.life;
        ctx.fillText(p.symbol, p.x, p.y);
      }
      ctx.globalAlpha = 1.0;
    }

    function handleMouseMove(e) {
      mouseX = e.clientX;
      mouseY = e.clientY;
      const hero = document.querySelector('.hero');
      if (hero) {
        const rect = hero.getBoundingClientRect();
        isMouseInHero = (
          mouseX >= rect.left &&
          mouseX <= rect.right &&
          mouseY >= rect.top &&
          mouseY <= rect.bottom
        );
      }
    }

    function handleResize() {
      if (auraCanvas) {
        const wrapper = auraCanvas.parentElement;
        if (wrapper) {
            auraCanvas.width = wrapper.clientWidth;
            auraCanvas.height = wrapper.clientHeight;
        }
      }
      const mainCanvas = document.getElementById('ball');
      if (mainCanvas) {
        const dpr = Math.min(2, window.devicePixelRatio||1);
        const side = mainCanvas.clientWidth||mainCanvas.parentElement.offsetWidth;
        mainCanvas.width = Math.floor(side*dpr);
        mainCanvas.height= Math.floor(side*dpr);
      }
      const cursorCanvas = document.getElementById('cursorAura');
      if (cursorCanvas) {
        cursorCanvas.width=window.innerWidth;
        cursorCanvas.height=window.innerHeight;
      }
    }

    function animateEffects() {
      if (auraCtx && auraCanvas) {
        auraCtx.clearRect(0, 0, auraCanvas.width, auraCanvas.height);
        drawPsychicAura(auraCtx);
        updateAndDrawAuraParticles(auraCtx);
      }
      updateEnergyWaves();
      requestAnimationFrame(animateEffects);
    }

    // === ИНИЦИАЛИЗАЦИЯ ===
    document.addEventListener('DOMContentLoaded', () => {
      const photoElement = document.getElementById('psychicPhoto');
      const stickyPhotoElement = document.querySelector('.sticky-whatsapp .avatar img');
      if (photoElement) {
          photoElement.src = SITE_SETTINGS.psychicImageURL;
          photoElement.alt = SITE_SETTINGS.psychicName ? `Фото ${SITE_SETTINGS.psychicName}` : "Фото гадалки";
      }
      if (stickyPhotoElement) {
          stickyPhotoElement.src = SITE_SETTINGS.psychicImageURL;
          stickyPhotoElement.alt = SITE_SETTINGS.psychicName ? `Фото ${SITE_SETTINGS.psychicName}` : "Фото гадалки";
      }

      initAllEffects();

      // Яндекс.Метрика
      if (SITE_SETTINGS.yandexMetrikaId) {
        const s = document.createElement('script');
        s.type = 'text/javascript'; s.async = true;
        s.innerHTML = `
          (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
          m[i].l=1*new Date();
          for(var j=0;j<document.scripts.length;j++){if(document.scripts[j].src===r)return;}
          k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
          (window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");
          ym(${SITE_SETTINGS.yandexMetrikaId},"init",{clickmap:true,trackLinks:true,accurateTrackBounce:true,webvisor:true});
        `;
        document.head.appendChild(s);
      }

      handleRedirect();

      // МАГИЧЕСКИЙ СКРОЛЛ-ЭФФЕКТ
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, { threshold: 0.1 });
      document.querySelectorAll('.card').forEach(card => {
        observer.observe(card);
      });

      // ОБЛАЧКО-ЧАТ НАД АВАТАРОМ
      const heroGreetings = [
        'Ночь раскрывает завесу тайн… 🌌',
        'Тайны луны ждут вашего вопроса 🌙',
        'Звезды шепчут о будущем 🔮',
        'Энергетика сейчас очень сильна ⚡',
        'Ваша судьба готова раскрыться',
        'Слушайте внутренний голос',
        'Магия пробуждается в полночь',
        'Карта дня уже выбрана для вас',
        'Дух времени благосклонен',
        'Ваша аура светится особо',
        'Сегодняшний день - знаковый',
        'Силы природы на вашей стороне',
        'Ваш ангел-хранитель рядом',
        'Портал возможностей открыт',
        'Скоро вы получите знак',
        'Ваши мысли материализуются',
        'Лунный свет дарует ясность',
        'Вселенная слышит вас',
        'Скоро наступит прозрение',
        'Ваш путь освещается звездами'
      ];

      function showHeroChat(){
        const randomIndex = Math.floor(Math.random() * heroGreetings.length);
        const text = heroGreetings[randomIndex];
        const chatBubble = document.getElementById('heroChatBubble');
        const span  = document.getElementById('heroChatText');
        if (!chatBubble || !span) return;
        span.textContent = '';
        chatBubble.classList.add('show');
        [...text].forEach((ch,i)=>{
          setTimeout(()=> span.textContent += ch, i*45);
        });
      }
      showHeroChat();

      // ОБЛАЧКО-ЧАТ В CTA
      const greetings = [
        'Пришло время перемен 🌙',
        'Ваше желание вот-вот сбудется',
        'Судьба готовит вам сюрприз',
        'Энергия удачи на подъеме',
        'Скоро наступит ясность',
        'Ваша интуиция не обманет',
        'Новые возможности уже рядом',
        'Сила Вселенной с вами',
        'Скоро вы получите ответ',
        'Ваши молитвы услышаны',
        'Магический момент настал',
        'Ваше будущее светло',
        'Знаки указывают на успех',
        'Ваш путь благословен',
        'Скоро исполнится заветное',
        'Ваши действия дадут плоды',
        'Судьба распахивает двери',
        'Ваше счастье на подходе',
        'Вселенная работает на вас',
        'Час чудес вот-вот настанет'
      ];

      function showCTAChat(){
        const randomIndex = Math.floor(Math.random() * greetings.length);
        const text = greetings[randomIndex];
        const chatBubble = document.getElementById('ctaChatBubble');
        const span  = document.getElementById('ctaChatText');
        if (!chatBubble || !span) return;
        span.textContent = '';
        chatBubble.classList.add('show');
        [...text].forEach((ch,i)=>{
          setTimeout(()=> span.textContent += ch, i*45);
        });
      }
      showCTAChat();

      // FLIP КАРТЫ
      document.querySelectorAll('.card').forEach(card=>{
        card.addEventListener('click', ()=>{
          card.classList.toggle('is-flipped');
          card.classList.toggle('is-open');
          if(navigator.vibrate) navigator.vibrate(10);
        });

        card.addEventListener('mouseenter', function(e) {
          const symbol = this.getAttribute('data-symbol');
          if (!symbol) return;
          const iconHover = document.createElement('div');
          iconHover.className = 'problem-icon-hover';
          iconHover.textContent = symbol;
          iconHover.style.left = `${e.offsetX}px`;
          iconHover.style.top = `${e.offsetY}px`;
          this.appendChild(iconHover);
          setTimeout(() => {
            if (iconHover.parentNode === this) {
              this.removeChild(iconHover);
            }
          }, 1000);
        });

        card.addEventListener('touchstart', () => {
          if (navigator.vibrate) navigator.vibrate(50);
        });
      });

      // ИСКРЫ ДЛЯ ЛИПКОЙ КНОПКИ
      function createSpark(x, y) {
        const spark = document.createElement('div');
        spark.className = 'spark';
        spark.innerHTML = '✨';
        spark.style.left = `${x}px`;
        spark.style.top = `${y}px`;
        spark.style.color = `hsl(${260 + Math.random() * 60}, 100%, 70%)`;
        document.body.appendChild(spark);

        const angle = Math.random() * Math.PI * 2;
        const speed = 2 + Math.random() * 3;
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed;
        let opacity = 1;

        function animate() {
          const currentX = parseFloat(spark.style.left);
          const currentY = parseFloat(spark.style.top);
          spark.style.left = `${currentX + vx}px`;
          spark.style.top = `${currentY + vy}px`;
          opacity -= 0.03;
          spark.style.opacity = opacity;

          if (opacity > 0) {
            requestAnimationFrame(animate);
          } else {
            spark.remove();
          }
        }
        animate();
      }

      document.getElementById('stickyWaBtn').addEventListener('click', function(e) {
        const rect = this.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;

        for (let i = 0; i < 15; i++) {
          setTimeout(() => {
            createSpark(centerX, centerY);
          }, i * 30);
        }
      });

      // АНИМАЦИЯ ПИСЬМА
      function animateEnvelope(startX, startY, endX, endY) {
        const envelope = document.createElement('div');
        envelope.className = 'envelope-animation';
        envelope.innerHTML = '✉️';
        envelope.style.setProperty('--startX', `${startX}px`);
        envelope.style.setProperty('--startY', `${startY}px`);
        envelope.style.setProperty('--endX', `${endX}px`);
        envelope.style.setProperty('--endY', `${endY}px`);
        document.body.appendChild(envelope);
        envelope.addEventListener('animationend', () => {
          envelope.remove();
        });
      }

      const originalOpenPortal = openPortal;
      window.openPortal = function(e) {
        e?.preventDefault();
        const btnRect = e?.target?.getBoundingClientRect();
        if (btnRect) {
          animateEnvelope(
            btnRect.left + btnRect.width / 2,
            btnRect.top + btnRect.height / 2,
            window.innerWidth - 50,
            window.innerHeight - 50
          );
        }
        originalOpenPortal(e);
      };

      // СЕКРЕТНЫЙ ЖЕСТ "ЛЮБОВЬ"
      let lastTap = 0;
      document.addEventListener('touchend', function(e) {
        const currentTime = new Date().getTime();
        const tapLength = currentTime - lastTap;
        if (tapLength < 300 && tapLength > 0) {
          if (e.changedTouches && e.changedTouches[0]) {
              createHeartAnimation(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
              setTimeout(() => {
                window.location.href = `https://wa.me/${SITE_SETTINGS.phoneNumber.replace(/\D/g,'')}?text=${encodeURIComponent('💜 нужна помощь')}`;
              }, 800);
          }
        }
        lastTap = currentTime;
      });

      function createHeartAnimation(x, y) {
        const heart = document.createElement('div');
        heart.className = 'heart-animation';
        heart.innerHTML = '💜';
        heart.style.left = `${x - 25}px`;
        heart.style.top = `${y - 25}px`;
        document.body.appendChild(heart);
        heart.addEventListener('animationend', () => {
          heart.remove();
        });
      }

      // МАГИЧЕСКИЙ ТАП-ЭФФЕКТ
      document.addEventListener('touchstart', function(e) {
        if (e.touches && e.touches[0]) {
            const touch = e.touches[0];
            createMagicTap(touch.clientX, touch.clientY);
        }
      });

      function createMagicTap(x, y) {
        const symbols = ['✨', '🔮', '✦', '✧', '☽'];
        const symbol = symbols[Math.floor(Math.random() * symbols.length)];
        const tap = document.createElement('div');
        tap.className = 'magic-tap';
        tap.style.left = x + 'px';
        tap.style.top = y + 'px';
        tap.innerHTML = symbol;
        const btn = document.querySelector('.sticky-whatsapp');
        if (btn) {
          const btnRect = btn.getBoundingClientRect();
          tap.style.setProperty('--startX', x + 'px');
          tap.style.setProperty('--startY', y + 'px');
          tap.style.setProperty('--endX', (btnRect.left + btnRect.width/2) + 'px');
          tap.style.setProperty('--endY', (btnRect.top + btnRect.height/2) + 'px');
        }
        document.body.appendChild(tap);
        setTimeout(() => tap.remove(), 1500);
      }
    });
  </script>
</body>
</html>
